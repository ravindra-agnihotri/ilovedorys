<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dory's Bakehouse ‚Äî Products</title>

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg: rgba(255,243,207,0.45);
  --accent:#563e30;
  --accent-2:#ff7f7f;
  --text:#563e30;
  --muted:#6e5a52;
  --card:rgba(253,239,193,0.45);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:'Poppins',system-ui;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;overflow-x:hidden}

/* header */
header{
  width:100%; background:#fff; padding:14px 20px; box-shadow:0 2px 8px rgba(0,0,0,0.08);
  position:sticky; top:0; z-index:1000; display:flex; align-items:center; justify-content:center; position:relative;
}
.home-btn{position:absolute; left:18px; background:var(--accent); color:#fff; padding:8px 12px; border-radius:10px; text-decoration:none; font-weight:600}
.logo-img{height:64px; width:auto}
.contact-btn{position:absolute; right:18px; background:var(--accent); color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer}

/* title */
h1.page-title{margin:18px 0 8px; text-align:center; font-family:'Great Vibes', cursive; font-size:40px}

/* search */
.search-wrap{max-width:1100px;margin:12px auto;padding:0 16px}
.search-box{display:flex;gap:10px}
.search-input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:#fff}

/* grid */
.grid{max-width:1200px;margin:18px auto 120px;padding:0 16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}

/* card */
.card{background:var(--card);border-radius:12px;padding:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);position:relative}
.img-wrap{height:160px;border-radius:10px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center}
.card img{width:100%;height:100%;object-fit:cover}
.name{font-weight:700;margin-top:8px}
.cat{color:var(--muted);font-size:13px;margin-top:4px}
.price{font-weight:700;margin-top:6px}

/* enquire overlay */
.overlay{position:absolute;inset:0;display:flex;align-items:flex-end;justify-content:center;pointer-events:none}
.cta{pointer-events:auto;margin:12px;background:linear-gradient(180deg, #ff7f7f, #563e30);color:#fff;padding:10px 14px;border-radius:999px;border:0;opacity:0;transform:translateY(8px);transition:all .15s}
.card:hover .cta{opacity:1;transform:translateY(0)}

/* enquiry popup */
.enq-popup{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:92%;max-width:420px;background:#fff;border-radius:12px;padding:14px;box-shadow:0 20px 48px rgba(0,0,0,0.3);display:none;z-index:4000}
.enq-popup .close-x{position:absolute;right:10px;top:8px;font-size:20px;cursor:pointer}
.enq-popup img{width:90px;height:90px;object-fit:cover;border-radius:8px}
.enq-popup textarea{width:100%;height:80px;border-radius:8px;padding:8px;border:1px solid #ddd;margin-top:8px}
.enq-popup .send{background:#25D366;color:#fff;padding:10px;border-radius:8px;border:0;width:100%;margin-top:10px;cursor:pointer}

/* floating chat/wa */
.floating{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:12px;z-index:3000}
.floating .btn{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,0.15);cursor:pointer;border:0}
.wh{background:#25D366}
.chat{background:var(--accent-2)}

/* hammer admin btn */
#adminLoginBtn{position:fixed;left:18px;bottom:100px;width:50px;height:50px;border-radius:12px;background:#fff;border:2px solid var(--accent);display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,0.18);cursor:pointer;z-index:3200}
#adminLoginBtn img{width:26px;height:26px}

/* manage button (admin only) */
#manageFloating{position:fixed;left:18px;bottom:18px;background:var(--accent);color:#fff;padding:12px 16px;border-radius:10px;display:none;text-decoration:none;font-weight:700;z-index:3200}

/* admin options modal (simple) */
.admin-modal-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:4500}
.admin-modal-backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.45)}
.admin-modal{position:relative;width:92%;max-width:420px;background:#fff;border-radius:12px;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,0.3);z-index:10}
.admin-modal h3{margin:0 0 12px;color:var(--text)}
.admin-actions{display:flex;flex-direction:column;gap:10px}
.admin-actions a{display:block;padding:10px 12px;border-radius:8px;text-align:center;background:var(--accent);color:#fff;text-decoration:none;font-weight:700}

/* contact popup */
.popup-overlay{position:fixed;inset:0;display:none;justify-content:center;align-items:center;background:rgba(0,0,0,0.45);z-index:5000}
.popup-box{background:#faebe3;padding:22px;border-radius:14px;text-align:center}
.popup-box h3{margin:0}
.close-btn{margin-top:14px;background:var(--accent);color:#fff;padding:10px;border-radius:8px;cursor:pointer}

/* responsive tweaks */
@media (max-width:640px){
  .img-wrap{height:140px}
  .grid{gap:12px}
}
</style>
</head>
<body>

<header>
  <a class="home-btn" href="/index.html">Home</a>
  <!-- logo local path (will be transformed by your host) -->
  <img class="logo-img" src="/mnt/data/5426C5C3-9890-4592-87F1-D8D068E94052.PNG" alt="Dory's Bakehouse">
  <div class="contact-btn" onclick="openContact()">Contact</div>
</header>

<h1 class="page-title">Our Products</h1>

<!-- SEARCH BAR -->
<div class="search-wrap">
  <div class="search-box">
    <input id="searchInput" class="search-input" placeholder="Search products by name, category or description...">
  </div>
</div>

<!-- PRODUCT GRID -->
<div id="grid" class="grid" aria-live="polite">Loading‚Ä¶</div>

<!-- FLOATING CHAT + WA -->
<div class="floating" aria-hidden="false">
  <button class="btn chat" onclick="openContact()" title="Chat">
    <img src="https://cdn-icons-png.flaticon.com/512/134/134914.png" width="26" alt="chat">
  </button>
  <a class="btn wh" id="waFloat" target="_blank" rel="noreferrer" title="WhatsApp">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="26" alt="wa">
  </a>
</div>

<!-- HAMMER admin button (always visible) -->
<div id="adminLoginBtn" title="Admin" onclick="openAdminLogin()">
  <img src="https://cdn-icons-png.flaticon.com/512/753/753244.png" alt="admin">
</div>

<!-- MANAGE PRODUCTS (admin only) -->
<a id="manageFloating" href="#" title="Manage Products">Manage Products</a>

<!-- ADMIN OPTIONS MODAL (opens when Manage clicked) -->
<div id="adminModal" class="admin-modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="admin-modal-backdrop" onclick="closeAdminModal()"></div>
  <div class="admin-modal" role="document">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>Admin Options</h3>
      <button onclick="closeAdminModal()" style="background:transparent;border:0;font-size:18px;cursor:pointer">√ó</button>
    </div>
    <div class="admin-actions">
      <a href="/upload.html" onclick="closeAdminModal()">Upload Images</a>
      <a href="/admin-products.html" onclick="closeAdminModal()">Manage Products</a>
    </div>
  </div>
</div>

<!-- ENQUIRY POPUP -->
<div id="enqPopup" class="enq-popup" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="close-x" onclick="closeEnq()">√ó</div>
  <div style="display:flex;gap:12px;align-items:center">
    <img id="enqImg" style="width:90px;height:90px;border-radius:8px" alt="">
    <div>
      <h3 id="enqName" style="margin:0"></h3>
      <p id="enqCat" style="margin:6px 0;color:var(--muted)"></p>
      <p id="enqPrice" style="margin:0 0 6px"></p>
    </div>
  </div>
  <textarea id="enqMsg" placeholder="Your message (delivery date, quantity...)"></textarea>
  <button class="send" onclick="sendEnquiry()">Send on WhatsApp</button>
</div>

<!-- CONTACT POPUP -->
<div id="contactPopup" class="popup-overlay" aria-hidden="true">
  <div class="popup-box">
    <h3>Contact Us</h3>
    <p>üìû <a href="tel:+917972032790" style="color:var(--text);text-decoration:none;font-weight:700">+91 7972032790</a></p>
    <p>üìç Dory's Bakehouse, Pune</p>
    <div class="close-btn" onclick="closeContact()">Close</div>
  </div>
</div>

<script>
/* config */
const WA_NUMBER = "919168445014";
document.getElementById('waFloat').href = "https://wa.me/" + WA_NUMBER;

/* cookie helper */
function readCookie(name){
  const c = document.cookie.split('; ').find(r=>r.trim().startsWith(name+'='));
  return c ? decodeURIComponent(c.split('=')[1]) : null;
}

/* admin UI update */
function updateAdminUI(){
  if(readCookie('admin') === '4321'){
    document.getElementById('manageFloating').style.display = 'block';
    document.getElementById('adminLoginBtn').style.display = 'none';
  } else {
    document.getElementById('manageFloating').style.display = 'none';
    document.getElementById('adminLoginBtn').style.display = 'flex';
  }
}

/* hammer admin button */
function openAdminLogin(){
  if(readCookie('admin') === '4321'){
    window.location.href = '/upload.html';
    return;
  }
  const pin = prompt("Enter Admin PIN:");
  if(pin === '4321'){
    document.cookie = 'admin=4321; path=/; max-age=86400;';
    updateAdminUI();
    window.location.href = '/upload.html';
  } else if(pin !== null){
    alert('Incorrect PIN');
  }
}

/* Manage button opens admin modal (only if admin) */
document.getElementById('manageFloating').addEventListener('click', function(e){
  e.preventDefault();
  if(readCookie('admin') === '4321'){
    openAdminModal();
  } else {
    openAdminLogin();
  }
});

function openAdminModal(){
  document.getElementById('adminModal').style.display = 'flex';
  document.getElementById('adminModal').setAttribute('aria-hidden','false');
}
function closeAdminModal(){
  document.getElementById('adminModal').style.display = 'none';
  document.getElementById('adminModal').setAttribute('aria-hidden','true');
}

/* contact popup */
function openContact(){ document.getElementById('contactPopup').style.display='flex'; document.getElementById('contactPopup').setAttribute('aria-hidden','false'); }
function closeContact(){ document.getElementById('contactPopup').style.display='none'; document.getElementById('contactPopup').setAttribute('aria-hidden','true'); }

/* enquiry popup */
let currentProduct = null;
function openEnquiry(product){
  currentProduct = product;
  document.getElementById('enqImg').src = product.image || '/images/products/default-sample.png';
  document.getElementById('enqName').textContent = product.name || '';
  document.getElementById('enqCat').textContent = product.category || '';
  document.getElementById('enqPrice').textContent = product.price ? '‚Çπ ' + product.price : '';
  document.getElementById('enqPopup').style.display = 'block';
  document.getElementById('enqPopup').setAttribute('aria-hidden','false');
}
function closeEnq(){
  document.getElementById('enqPopup').style.display = 'none';
  document.getElementById('enqPopup').setAttribute('aria-hidden','true');
}
function sendEnquiry(){
  const msg = document.getElementById('enqMsg').value || '';
  if(!currentProduct) return;
  const text = `Product Enquiry:%0AName: ${currentProduct.name}%0ACategory: ${currentProduct.category || ''}%0APrice: ${currentProduct.price || ''}%0A%0AMessage:%0A${encodeURIComponent(msg)}`;
  window.open(`https://wa.me/${WA_NUMBER}?text=${text}`, '_blank');
  closeEnq();
}

/* products load/render */
let products = [];
const grid = document.getElementById('grid');

async function loadProducts(){
  try{
    const res = await fetch('/products/list', {cache: 'no-cache'});
    products = await res.json();
  }catch(e){
    console.error('Failed to load products', e);
    products = [];
  }
  render();
}

function render(){
  const q = (document.getElementById('searchInput')?.value || '').trim().toLowerCase();
  let list = products.filter(p=>{
    const text = ((p.name||'') + ' ' + (p.category||'') + ' ' + (p.description||'')).toLowerCase();
    return !q || text.includes(q);
  });

  grid.innerHTML = '';
  if(!list.length){
    grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;color:var(--muted);padding:36px">No products found.</div>`;
    return;
  }

  list.forEach(p=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="img-wrap"><img src="${p.image || '/images/products/default-sample.png'}" alt="${escapeHtml(p.name)}"></div>
      <div class="name">${escapeHtml(p.name)}</div>
      <div class="cat">${escapeHtml(p.category)}</div>
      <div class="price">‚Çπ ${escapeHtml(p.price)}</div>
      <div class="overlay"><button class="cta">Enquire Now</button></div>
    `;
    card.querySelector('.cta').addEventListener('click', ()=> openEnquiry(p));
    grid.appendChild(card);
  });
}
function escapeHtml(s){ return (s||'').toString().replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* search handler */
document.getElementById('searchInput').addEventListener('input', render);

/* show admin UI & init */
window.addEventListener('DOMContentLoaded', ()=>{
  updateAdminUI();
  loadProducts();
  // refresh periodically so new uploads appear
  setInterval(loadProducts, 90000);
});
</script>
</body>
</html>
