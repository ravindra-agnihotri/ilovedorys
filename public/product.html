<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Products ‚Äì Dory's Bakehouse</title>

    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #FAF0DE;
            --accent: #563e30;
            --text: #563e30;
        }

        body {
            margin: 0;
            background: var(--bg);
            font-family: system-ui;
            overflow-x: hidden;
        }

        /* HEADER */
        header {
            width: 100%;
            background: #fff;
            padding: 14px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            position: relative;
        }

        header img.logo {
            height: 64px;
        }

        .left-btn,
        .right-btn,
        .manage-btn {
            position: absolute;
            background: var(--accent);
            color: #fff;
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .left-btn { left: 25px; }
        .right-btn { right: 25px; }

        /* TITLE */
        h2 {
            text-align: center;
            font-family: 'Great Vibes', cursive;
            color: var(--text);
            font-size: 42px;
            margin: 20px 0;
        }

        /* PRODUCT GRID */
        .products-grid {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            gap: 18px;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        }

        .product-card {
            background: #ffffffd5;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
            overflow: hidden;
            padding-bottom: 12px;
        }

        .product-card img {
            width: 100%;
            height: 190px;
            object-fit: cover;
            background: #eee;
        }

        .product-info {
            padding: 12px;
            text-align: center;
        }
        .product-info h3 {
            margin: 6px 0;
            color: var(--text);
            font-size: 18px;
        }
        .product-info p {
            margin: 5px 0;
            font-size: 14px;
            color: #444;
        }
        .price {
            margin-top: 6px;
            color: var(--accent);
            font-weight: bold;
            font-size: 16px;
        }

        /* MANAGE BUTTON CENTER */
        .manage-btn {
            margin: 20px auto;
            display: block;
            width: fit-content;
        }

        /* ADMIN POPUP */
        #adminPopup {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 5000;
        }
        #adminPopup .box {
            background: #faebe3;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 330px;
            text-align: center;
            box-shadow: 0 6px 22px rgba(0,0,0,0.14);
        }
        #adminError {
            color: red;
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }
    </style>
</head>

<body>

<header>
    <!-- Left button -->
    <a class="left-btn" href="/index.html">Home</a>

    <!-- Logo -->
    <img class="logo" src="logo/dorys.PNG" alt="Dory‚Äôs Bakehouse Logo">

    <!-- Right button -->
    <a class="right-btn" onclick="openContactPopup()">Contact</a>
</header>

<h2>Baked fresh with love and sugar</h2>

<!-- PRODUCT LIST GRID -->
<div class="products-grid" id="productsGrid">
    Loading products...
</div>

<!-- MANAGE PRODUCTS BUTTON -->
<a class="manage-btn" onclick="openAdminLogin()">Manage Products</a>

<!-- ADMIN LOGIN POPUP -->
<div id="adminPopup">
    <div class="box">
        <h3 style="margin:0;color:#563e30">Enter Admin PIN</h3>

        <input id="adminPinInput" type="password" maxlength="6"
               style="margin-top:14px;width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:16px;text-align:center;">

        <button onclick="checkAdminPin()" style="
            margin-top:14px;background:#563e30;color:#fff;border:none;
            padding:10px 18px;border-radius:8px;cursor:pointer;">Submit</button>

        <div id="adminError">Incorrect PIN</div>
    </div>
</div>

<script>
    /* -----------------------------
       Load Product List from Server
    ------------------------------ */
    async function loadProducts() {
        const grid = document.getElementById("productsGrid");

        try {
            const res = await fetch("/products/list", { cache: "no-cache" });
            const products = await res.json();

            if (!products.length) {
                grid.innerHTML = "<p style='text-align:center;color:#666;'>No products added yet.</p>";
                return;
            }

            grid.innerHTML = "";

            products.forEach(p => {
                const card = document.createElement("div");
                card.className = "product-card";

                const img = document.createElement("img");
                img.src = p.image;
                img.onerror = () => img.src = "/images/products/default-sample.png";

                const info = document.createElement("div");
                info.className = "product-info";

                info.innerHTML = `
                <h3>${p.name}</h3>
                <p>${p.description || ""}</p>
                <div class="price">‚Çπ ${p.price || ""}</div>
            `;

                card.appendChild(img);
                card.appendChild(info);
                grid.appendChild(card);
            });

        } catch (err) {
            console.error(err);
            document.getElementById("productsGrid").innerHTML =
                "<p style='color:red;text-align:center;'>Unable to load products.</p>";
        }
    }

    loadProducts();

    /* -----------------------------
       Admin PIN Popup
    ------------------------------ */
    function openAdminLogin() {
        document.getElementById("adminPopup").style.display = "flex";
        document.getElementById("adminPinInput").value = "";
        document.getElementById("adminError").style.display = "none";
    }

    function checkAdminPin() {
        const pin = document.getElementById("adminPinInput").value;

        if (pin === "4321") {
            window.location.href = "/admin-products.html";
        } else {
            document.getElementById("adminError").style.display = "block";
        }
    }

    document.getElementById("adminPopup").addEventListener("click", e => {
        if (e.target.id === "adminPopup") {
            document.getElementById("adminPopup").style.display = "none";
        }
    });

    /* -----------------------------
       Contact Button (from index)
    ------------------------------ */
    function openContactPopup() {
        alert("Contact Us \n üìû Contact: +91 9168445014\nüìç Dory's Bakehouse, Pune");
    }
</script>

</body>
</html>
