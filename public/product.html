<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dory's Bakehouse ‚Äî Products</title>

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg: rgba(255, 243, 207, 0.45);
  --accent: #563e30;
  --accent-2: #ff7f7f;
  --text: #563e30;
  --muted: #6e5a52;
  --card: rgba(253,239,193,0.45);

  /* Gold glow */
  --gold: #d4af37;
  --gold-glow: 0 8px 28px rgba(212,175,55,0.18);
}

/* Reset / base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:'Poppins',system-ui;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;overflow-x:hidden}

/* HEADER */
header{
  width:100%;
  background:#fff;
  padding:14px 20px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  position:sticky; top:0; z-index:1200;
  display:flex; align-items:center; justify-content:center; position:relative;
}
.home-btn{position:absolute; left:18px; background:var(--accent); color:#fff; padding:8px 12px; border-radius:10px; text-decoration:none; font-weight:600;}
.logo-img{height:64px; width:auto; border-radius:8px}
.contact-btn{position:absolute; right:18px; background:var(--accent); color:#fff; padding:8px 12px; border-radius:8px; font-weight:600; cursor:pointer;}

/* TITLE */
h1.page-title{margin:18px 0 8px; text-align:center; font-family:'Great Vibes', cursive; font-size:42px; color:var(--text);}

/* FILTERS */
.filters{max-width:1200px; margin:8px auto; padding:0 16px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap;}
.filter-btn{background:#fff; padding:8px 14px; border-radius:999px; border:1px solid rgba(0,0,0,0.06); font-weight:600; cursor:pointer; color:var(--accent);}
.filter-btn.active{background:var(--accent-2); color:#fff;}

/* SEARCH */
.search-wrap{max-width:1200px; margin:12px auto; padding:0 16px;}
.search-box{display:flex; gap:10px;}
.search-input{flex:1; padding:12px 14px; border-radius:10px; border:1px solid rgba(0,0,0,0.06); background:#fff; font-size:15px;}
.sort-select{padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,0.06); background:#fff;}

/* GRID */
.grid{max-width:1300px; margin:18px auto 140px; padding:0 16px; display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:18px;}

/* CARD */
.card{background:var(--card); padding:10px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); position:relative; overflow:hidden;}
.img-wrap{height:180px; border-radius:10px; overflow:hidden; background:#fff; display:flex; align-items:center; justify-content:center;}
.card img{width:100%; height:100%; object-fit:cover;}
.name{font-weight:700; margin-top:10px;}
.cat{color:var(--muted); font-size:13px; margin-top:4px;}
.price{font-weight:700; margin-top:6px;}

/* OVERLAY CTA */
.overlay{position:absolute; inset:0; display:flex; align-items:flex-end; justify-content:center; pointer-events:none;}
.cta{pointer-events:auto; background:linear-gradient(180deg, rgba(255,127,127,0.98), rgba(86,62,48,0.95)); color:#fff; padding:10px 14px; border-radius:999px; border:0; margin:14px; opacity:0; transform:translateY(10px); transition:all .18s; box-shadow:0 12px 28px rgba(0,0,0,0.18);}
.card:hover .cta{opacity:1; transform:translateY(0);}

/* ENQUIRY POPUP (center) */
.enq-popup{position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:92%; max-width:460px; background:#fff; border-radius:12px; padding:16px; box-shadow:0 22px 58px rgba(0,0,0,0.42); z-index:5000; display:none;}
.enq-popup .close-x{position:absolute; right:10px; top:8px; font-size:22px; color:#fff; background:rgba(0,0,0,0.45); width:34px; height:34px; border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:pointer;}
.enq-popup .row{display:flex; gap:12px; align-items:center;}
.enq-popup img{width:96px; height:96px; object-fit:cover; border-radius:8px;}
.enq-popup textarea{width:100%; height:80px; margin-top:8px; border-radius:8px; padding:8px; border:1px solid #ddd;}
.enq-popup .send{background:#25D366; color:#fff; padding:10px; border-radius:8px; border:0; width:100%; margin-top:10px; cursor:pointer;}

/* FLOATING CHAT/WA */
.floating{position:fixed; right:18px; bottom:18px; display:flex; flex-direction:column; gap:12px; z-index:3000;}
.floating .btn{width:56px; height:56px; border-radius:50%; display:flex; align-items:center; justify-content:center; box-shadow:0 8px 24px rgba(0,0,0,0.14); cursor:pointer; border:0;}
.wh{background:#25D366;}
.chat{background:var(--accent-2);}

/* ADMIN BUTTONS */
/* small hammer icon (always visible) */
#adminLoginBtn{
  position:fixed; left:18px; bottom:100px; width:50px; height:50px; background:#fff; border:2px solid var(--accent); border-radius:12px; display:flex; align-items:center; justify-content:center; box-shadow:0 6px 18px rgba(0,0,0,0.18); cursor:pointer; z-index:3200;
}
#adminLoginBtn img{width:26px; height:26px;}

/* manage button (appears after login) */
#manageFloating{position:fixed; left:18px; bottom:18px; background:var(--accent); color:#fff; padding:12px 16px; border-radius:10px; display:none; text-decoration:none; font-weight:700; box-shadow:0 8px 24px rgba(0,0,0,0.14); z-index:3200;}

/* ADMIN OPTIONS POPUP (P3 - dark glass) */
.admin-modal-overlay{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:4500;
  backdrop-filter: blur(6px);
}
.admin-modal-backdrop{
  position:absolute; inset:0; background:rgba(0,0,0,0.55);
}
.admin-modal{
  position:relative; width:92%; max-width:420px; border-radius:14px; padding:20px;
  background: linear-gradient(180deg, rgba(20,20,20,0.88), rgba(12,12,12,0.92));
  box-shadow: 0 30px 80px rgba(0,0,0,0.6);
  color:#fff; z-index:10; transform:translateY(-6px);
  border:1px solid rgba(255,255,255,0.04);
}
.admin-modal h3{margin:0 0 12px; font-size:18px; color:#fff;}
.admin-options{display:flex; gap:12px; flex-direction:column;}
.admin-btn{
  display:flex; gap:12px; align-items:center; padding:12px 14px; border-radius:10px; cursor:pointer;
  border:1px solid rgba(255,255,255,0.04); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  transition:transform .12s, box-shadow .12s;
}
.admin-btn:hover{transform:translateY(-4px); box-shadow:0 12px 36px rgba(212,175,55,0.12);}

/* Gold-glow style for action buttons (C1) */
.admin-btn.gold{
  border:1px solid rgba(212,175,55,0.25);
  box-shadow: var(--gold-glow);
}
.admin-btn .icon{
  width:44px; height:44px; border-radius:10px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.02);
}
.admin-btn .label{font-weight:700; color:#fff; font-size:15px;}
.admin-close{position:absolute; top:12px; right:12px; font-size:20px; color:#fff; cursor:pointer;}

/* responsive tweaks */
@media(max-width:640px){
  .admin-btn{padding:10px}
  .enq-popup img{width:80px;height:80px}
  .img-wrap{height:160px}
}
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <a class="home-btn" href="/index.html">Home</a>
  <!-- logo uses uploaded local path (will be transformed to URL by your environment) -->
  <img class="logo-img" src="/mnt/data/5426C5C3-9890-4592-87F1-D8D068E94052.PNG" alt="Dory's Bakehouse">
  <div class="contact-btn" onclick="openContact()">Contact</div>
</header>

<!-- TITLE -->
<h1 class="page-title">Our Products</h1>

<!-- FILTERS -->
<div class="filters" role="tablist" aria-label="Categories">
  <button class="filter-btn active" data-cat="all">All</button>
  <button class="filter-btn" data-cat="Cakes">Cakes</button>
  <button class="filter-btn" data-cat="Cupcakes">Cupcakes</button>
  <button class="filter-btn" data-cat="Pastries">Pastries</button>
</div>

<!-- SEARCH -->
<div class="search-wrap">
  <div class="search-box">
    <input id="searchInput" class="search-input" placeholder="Search products by name, category or description...">
    <select id="sortSelect" class="sort-select">
      <option value="newest">Newest</option>
      <option value="price-asc">Price: Low ‚Üí High</option>
      <option value="price-desc">Price: High ‚Üí Low</option>
    </select>
  </div>
</div>

<!-- GRID -->
<div id="grid" class="grid" aria-live="polite">Loading‚Ä¶</div>

<!-- FLOATING CHAT + WA -->
<div class="floating" aria-hidden="false">
  <button class="btn chat" onclick="openContact()" title="Chat">
    <img src="https://cdn-icons-png.flaticon.com/512/134/134914.png" width="26" alt="chat">
  </button>
  <a class="btn wh" id="waFloat" target="_blank" rel="noreferrer" title="WhatsApp">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="26" alt="wa">
  </a>
</div>

<!-- ALWAYS VISIBLE HAMMER ADMIN BUTTON -->
<div id="adminLoginBtn" title="Admin" onclick="openAdminLogin()">
  <img src="https://cdn-icons-png.flaticon.com/512/753/753244.png" alt="admin">
</div>

<!-- MANAGE BUTTON (visible after login) -->
<a id="manageFloating" href="#" title="Manage Products">Manage Products</a>

<!-- ADMIN OPTIONS POPUP (P3 dark glass) -->
<div id="adminModal" class="admin-modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="admin-modal-backdrop" onclick="closeAdminModal()"></div>
  <div class="admin-modal" role="document">
    <div class="admin-close" onclick="closeAdminModal()">√ó</div>
    <h3>Admin Options</h3>
    <div class="admin-options">
      <div class="admin-btn gold" onclick="goToUpload()">
        <div class="icon"><img src="https://cdn-icons-png.flaticon.com/512/1828/1828911.png" alt="upload" width="20"></div>
        <div class="label">Upload Images</div>
      </div>

      <div class="admin-btn gold" onclick="goToManage()">
        <div class="icon"><img src="https://cdn-icons-png.flaticon.com/512/2989/2989988.png" alt="manage" width="20"></div>
        <div class="label">Manage Products</div>
      </div>
    </div>
  </div>
</div>

<!-- ENQUIRY POPUP -->
<div id="enqPopup" class="enq-popup" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="close-x" onclick="closeEnq()">√ó</div>
  <div class="row">
    <img id="enqImg" alt="">
    <div>
      <h3 id="enqName"></h3>
      <p id="enqCat" style="margin:6px 0;color:var(--muted)"></p>
      <p id="enqPrice" style="margin:0 0 6px"></p>
    </div>
  </div>
  <textarea id="enqMsg" placeholder="Your message (delivery date, quantity...)"></textarea>
  <button class="send" onclick="sendEnquiry()">Send on WhatsApp</button>
</div>

<!-- CONTACT POPUP -->
<div id="contactPopup" class="popup-overlay" aria-hidden="true">
  <div class="popup-box" role="dialog">
    <h3>Contact Us</h3>
    <p>üìû <a href="tel:+917972032790" style="color:var(--text);text-decoration:none;font-weight:700">+91 7972032790</a></p>
    <p>üìç Dory's Bakehouse, Pune</p>
    <div class="close-btn" onclick="closeContact()">Close</div>
  </div>
</div>

<script>
/* CONFIG */
const WA_NUMBER = "919168445014";
document.getElementById('waFloat').href = "https://wa.me/" + WA_NUMBER;

/* Cookie helper */
function readCookie(name){
  const c = document.cookie.split('; ').find(r=>r.trim().startsWith(name+'='));
  return c ? decodeURIComponent(c.split('=')[1]) : null;
}

/* Show manage button if admin cookie exists */
function updateAdminUI(){
  if(readCookie('admin') === '4321'){
    document.getElementById('manageFloating').style.display = 'block';
    document.getElementById('adminLoginBtn').style.display = 'none';
  } else {
    document.getElementById('manageFloating').style.display = 'none';
    document.getElementById('adminLoginBtn').style.display = 'flex';
  }
}

/* HAMMER ADMIN BUTTON behavior */
function openAdminLogin(){
  // if already logged in -> go straight to upload
  if(readCookie('admin') === '4321'){
    window.location.href = '/upload.html';
    return;
  }
  const pin = prompt("Enter Admin PIN:");
  if(pin === '4321'){
    // set cookie site-wide for 1 day
    document.cookie = "admin=4321; path=/; max-age=86400;";
    updateAdminUI();
    // redirect to upload page
    window.location.href = '/upload.html';
  } else if(pin !== null){
    alert('Incorrect PIN');
  }
}

/* MANAGE button -> open admin options popup (C) */
document.getElementById('manageFloating').addEventListener('click', (e)=>{
  e.preventDefault();
  // only open modal if admin
  if(readCookie('admin') === '4321'){
    openAdminModal();
  } else {
    // if somehow visible but not admin, prompt
    openAdminLogin();
  }
});

/* Admin modal controls */
function openAdminModal(){
  document.getElementById('adminModal').style.display = 'flex';
  document.getElementById('adminModal').setAttribute('aria-hidden','false');
}
function closeAdminModal(){
  document.getElementById('adminModal').style.display = 'none';
  document.getElementById('adminModal').setAttribute('aria-hidden','true');
}
function goToUpload(){
  closeAdminModal();
  window.location.href = '/upload.html';
}
function goToManage(){
  closeAdminModal();
  window.location.href = '/admin-products.html';
}

/* Contact popup */
function openContact(){ const el = document.getElementById('contactPopup'); el.style.display = 'flex'; el.setAttribute('aria-hidden','false'); }
function closeContact(){ const el = document.getElementById('contactPopup'); el.style.display = 'none'; el.setAttribute('aria-hidden','true'); }

/* Enquiry popup */
let currentProduct = null;
function openEnquiry(p){
  currentProduct = p;
  document.getElementById('enqImg').src = p.image || '/images/products/default-sample.png';
  document.getElementById('enqName').textContent = p.name || '';
  document.getElementById('enqCat').textContent = p.category || '';
  document.getElementById('enqPrice').textContent = p.price ? '‚Çπ ' + p.price : '';
  document.getElementById('enqPopup').style.display = 'block';
  document.getElementById('enqPopup').setAttribute('aria-hidden','false');
}
function closeEnq(){ document.getElementById('enqPopup').style.display = 'none'; document.getElementById('enqPopup').setAttribute('aria-hidden','true'); }
function sendEnquiry(){
  const msg = document.getElementById('enqMsg').value || '';
  if(!currentProduct) return;
  const text = `Product Enquiry:%0AName: ${currentProduct.name}%0ACategory: ${currentProduct.category || ''}%0APrice: ${currentProduct.price || ''}%0A%0AMessage:%0A${encodeURIComponent(msg)}`;
  window.open(`https://wa.me/${WA_NUMBER}?text=${text}`, '_blank');
  closeEnq();
}

/* PRODUCTS: fetch and render */
let products = [];
let activeCategory = 'all';
const grid = document.getElementById('grid');

async function loadProducts(){
  try{
    const res = await fetch('/products/list', {cache: 'no-cache'});
    products = await res.json();
  } catch(e){
    console.error('Failed to load products', e);
    products = [];
  }
  render();
}

function render(){
  const q = (document.getElementById('searchInput')?.value || '').trim().toLowerCase();
  const sortMode = document.getElementById('sortSelect')?.value || 'newest';

  let list = products.filter(p=>{
    const catOK = activeCategory === 'all' || ((p.category||'').toLowerCase() === activeCategory.toLowerCase());
    const text = ((p.name||'') + ' ' + (p.category||'') + ' ' + (p.description||'')).toLowerCase();
    const matches = !q || text.includes(q);
    return catOK && matches;
  });

  if(sortMode === 'price-asc') list.sort((a,b)=> (Number(a.price)||0) - (Number(b.price)||0));
  else if(sortMode === 'price-desc') list.sort((a,b)=> (Number(b.price)||0) - (Number(a.price)||0));
  else list.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));

  grid.innerHTML = '';
  if(!list.length){
    grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;color:var(--muted);padding:36px">No products found.</div>`;
    return;
  }

  list.forEach(p=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="img-wrap"><img src="${p.image || '/images/products/default-sample.png'}" alt="${escapeHtml(p.name)}"></div>
      <div class="name">${escapeHtml(p.name)}</div>
      <div class="cat">${escapeHtml(p.category)}</div>
      <div class="price">‚Çπ ${escapeHtml(p.price)}</div>
      <div class="overlay"><button class="cta">Enquire Now</button></div>
    `;
    card.querySelector('.cta').addEventListener('click', ()=> openEnquiry(p));
    grid.appendChild(card);
  });
}

function escapeHtml(s){ return (s||'').toString().replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* FILTERS */
document.querySelectorAll('.filter-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    activeCategory = btn.dataset.cat || 'all';
    render();
  });
});

/* SEARCH & SORT */
document.getElementById('searchInput').addEventListener('input', render);
document.getElementById('sortSelect').addEventListener('change', render);

/* Admin modal opener from manageFloating */
document.getElementById('manageFloating').addEventListener('click', (e) => {
  e.preventDefault();
  if(readCookie('admin') === '4321') openAdminModal();
  else openAdminLogin();
});

/* Show/hide admin UI on load */
window.addEventListener('DOMContentLoaded', () => {
  updateAdminUI();
  loadProducts();
  // refresh periodically so new uploads appear quickly
  setInterval(loadProducts, 90000);
});

/* Close admin modal on backdrop click handled via backdrop element */
document.querySelectorAll('.admin-modal-backdrop').forEach(b => b.addEventListener('click', closeAdminModal));
</script>
</body>
</html>
