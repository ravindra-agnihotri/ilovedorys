<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dory's Bakehouse ‚Äî Products</title>

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg: rgba(255, 243, 207, 0.45);
  --accent: #563e30;
  --accent-2: #ff7f7f;
  --text: #563e30;
  --muted: #6e5a52;
  --card: rgba(253,239,193,0.45);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Poppins',system-ui;
  background:var(--bg);
  color:var(--text);
  overflow-x:hidden;
}

/* HEADER */
header{
  width:100%;
  background:#fff;
  padding:14px 20px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  position:sticky;
  top:0; z-index:1000;
  display:flex; align-items:center; justify-content:center;
  position:relative;
}
.home-btn{
  position:absolute; left:18px;
  background:var(--accent); color:#fff;
  padding:8px 12px; border-radius:10px;
  text-decoration:none; font-weight:600;
}
.logo-img{
  height:64px; width:auto; border-radius:8px;
}
.contact-btn{
  position:absolute; right:18px;
  background:var(--accent); color:#fff;
  padding:8px 12px; border-radius:8px;
  font-weight:600; cursor:pointer;
}

/* TITLE */
h1.page-title{
  text-align:center;
  margin:20px 0 10px;
  font-family:'Great Vibes',cursive;
  font-size:42px;
}

/* FILTERS */
.filters{
  max-width:1200px;
  margin:8px auto;
  padding:0 16px;
  display:flex;
  justify-content:center;
  gap:8px;
  flex-wrap:wrap;
}
.filter-btn{
  background:#fff;
  padding:8px 14px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,0.06);
  font-weight:600;
  cursor:pointer;
}
.filter-btn.active{
  background:var(--accent-2);
  color:#fff;
}

/* SEARCH */
.search-wrap{
  max-width:1200px;
  margin:12px auto;
  padding:0 16px;
}
.search-box{
  display:flex;
  gap:10px;
}
.search-input{
  flex:1;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.06);
  background:#fff;
}
.sort-select{
  padding:10px 12px;
  border-radius:10px;
  background:#fff;
  border:1px solid rgba(0,0,0,0.06);
}

/* GRID */
.grid{
  max-width:1300px;
  margin:18px auto 80px;
  padding:0 16px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:18px;
}

/* PRODUCT CARD */
.card{
  background:var(--card);
  padding:10px;
  border-radius:12px;
  box-shadow:0 6px 18px rgba(0,0,0,0.06);
  position:relative;
}
.card .img-wrap{
  height:180px;
  background:#fff;
  border-radius:10px;
  overflow:hidden;
}
.card img{
  width:100%; height:100%;
  object-fit:cover;
}
.name{font-weight:700; margin-top:10px;}
.cat{color:var(--muted); font-size:13px;}
.price{font-weight:700; margin-top:6px;}

/* ENQUIRE OVERLAY */
.overlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  pointer-events:none;
}
.overlay .cta{
  pointer-events:auto;
  background:linear-gradient(180deg, rgba(255,127,127,0.98), rgba(86,62,48,0.95));
  color:#fff;
  padding:10px 14px;
  border-radius:999px;
  border:none;
  margin:14px;
  opacity:0;
  transform:translateY(10px);
  transition:all .18s;
}
.card:hover .cta{
  opacity:1;
  transform:translateY(0);
}

/* ENQUIRE POPUP */
.enq-popup{
  position:fixed; left:50%; top:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  width:92%; max-width:420px;
  border-radius:12px;
  padding:16px;
  box-shadow:0 18px 48px rgba(0,0,0,0.35);
  display:none;
  z-index:5000;
}
.enq-popup .close-x{
  position:absolute; right:10px; top:10px;
  cursor:pointer; font-size:22px;
}

/* FLOATING BUTTONS (CHAT/WA) */
.floating{
  position:fixed; right:18px; bottom:18px;
  display:flex; flex-direction:column;
  gap:12px; z-index:2000;
}
.floating .btn{
  width:56px; height:56px;
  border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 6px 18px rgba(0,0,0,0.15);
}
.wh{background:#25D366;}
.chat{background:var(--accent-2);}

/* ALWAYS VISIBLE ADMIN BUTTON */
#adminLoginBtn{
  position:fixed;
  left:18px;
  bottom:80px;
  width:50px;
  height:50px;
  background:#fff;
  border:2px solid var(--accent);
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 6px 18px rgba(0,0,0,0.18);
  cursor:pointer;
  z-index:3000;
}
#adminLoginBtn img{
  width:26px; height:26px;
}

/* MANAGE BUTTON (after login) */
#manageFloating{
  position:fixed;
  left:18px;
  bottom:18px;
  background:var(--accent);
  color:#fff;
  padding:12px 16px;
  border-radius:10px;
  font-weight:700;
  text-decoration:none;
  display:none;
  box-shadow:0 8px 24px rgba(0,0,0,0.14);
  z-index:3000;
}

/* CONTACT POPUP */
.popup-overlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,0.45);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:6000;
}
.popup-box{
  background:#faebe3;
  padding:22px;
  border-radius:14px;
  text-align:center;
}
</style>
</head>
<body>

<header>
  <a class="home-btn" href="/index.html">Home</a>
  <img class="logo-img" src="/logo/dorys.PNG">
  <div class="contact-btn" onclick="openContact()">Contact</div>
</header>

<h1 class="page-title">Our Products</h1>

<!-- FILTERS -->
<div class="filters">
  <button class="filter-btn active" data-cat="all">All</button>
  <button class="filter-btn" data-cat="Cakes">Cakes</button>
  <button class="filter-btn" data-cat="Cupcakes">Cupcakes</button>
  <button class="filter-btn" data-cat="Pastries">Pastries</button>
</div>

<!-- SEARCH BAR -->
<div class="search-wrap">
  <div class="search-box">
    <input id="searchInput" class="search-input" placeholder="Search products...">
    <select id="sortSelect" class="sort-select">
      <option value="newest">Newest</option>
      <option value="price-asc">Price: Low ‚Üí High</option>
      <option value="price-desc">Price: High ‚Üí Low</option>
    </select>
  </div>
</div>

<!-- GRID -->
<div id="grid" class="grid"></div>

<!-- FLOATING BUTTONS -->
<div class="floating">
  <button class="btn chat" onclick="openContact()">
    <img src="https://cdn-icons-png.flaticon.com/512/134/134914.png" width="26">
  </button>
  <a class="btn wh" id="waFloat" target="_blank">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="26">
  </a>
</div>

<!-- ALWAYS VISIBLE HAMMER ADMIN BUTTON -->
<div id="adminLoginBtn" onclick="openAdminLogin()">
  <img src="https://cdn-icons-png.flaticon.com/512/753/753244.png">
</div>

<!-- MANAGE BUTTON -->
<a id="manageFloating" href="/admin-products.html">Manage Products</a>

<!-- ENQUIRE POPUP -->
<div id="enqPopup" class="enq-popup">
  <span class="close-x" onclick="closeEnq()">√ó</span>
  <div style="display:flex;gap:12px;align-items:center">
    <img id="enqImg" style="width:90px;height:90px;border-radius:10px;">
    <div>
      <h3 id="enqName" style="margin:0"></h3>
      <p id="enqCat"></p>
      <p id="enqPrice"></p>
    </div>
  </div>
  <textarea id="enqMsg" placeholder="Your message..."></textarea>
  <button class="send" onclick="sendEnquiry()" style="margin-top:10px;background:#25D366;color:#fff;border:0;padding:10px;width:100%;border-radius:8px;cursor:pointer;">
    Send on WhatsApp
  </button>
</div>

<!-- CONTACT POPUP -->
<div id="contactPopup" class="popup-overlay">
  <div class="popup-box">
    <h3>Contact Us</h3>
    <p>üìû <a href="tel:+917972032790">+91 7972032790</a></p>
    <p>üìç Dory's Bakehouse, Pune</p>
    <div class="close-btn" onclick="closeContact()" style="background:var(--accent);color:#fff;padding:10px;border-radius:8px;cursor:pointer;">Close</div>
  </div>
</div>

<script>
/* WHATSAPP */
const WA_NUMBER = "919168445014";
document.getElementById("waFloat").href = "https://wa.me/" + WA_NUMBER;

/* COOKIE */
function readCookie(name){
  const c = document.cookie.split('; ').find(r=>r.startsWith(name+'='));
  return c ? c.split('=')[1] : null;
}

/* SHOW MANAGE BUTTON */
function showManageBtn(){
  document.getElementById("manageFloating").style.display="block";
  document.getElementById("adminLoginBtn").style.display="none";
}

/* HAMMER BUTTON BEHAVIOR */
function openAdminLogin(){
  // Already logged in -> go directly to Upload Page
  if(readCookie("admin") === "4321"){
    window.location.href = "/upload.html";
    return;
  }

  const pin = prompt("Enter Admin PIN:");
  if(pin === "4321"){
    document.cookie = "admin=4321; path=/; max-age=86400;";
    showManageBtn();
    window.location.href = "/upload.html"; // AUTO redirect after login
  } else if(pin !== null){
    alert("Incorrect PIN");
  }
}

/* ON LOAD */
window.addEventListener("DOMContentLoaded", ()=>{
  if(readCookie("admin") === "4321"){
    showManageBtn();
  }
  loadProducts();
});

/* CONTACT POPUP */
function openContact(){document.getElementById("contactPopup").style.display="flex";}
function closeContact(){document.getElementById("contactPopup").style.display="none";}

/* PRODUCTS */
let products=[];
async function loadProducts(){
  const r = await fetch("/products/list");
  products = await r.json();
  render();
}

function escapeHtml(s){
  return (s||"").toString().replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

let activeCategory="all";
document.querySelectorAll(".filter-btn").forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    activeCategory = btn.dataset.cat;
    render();
  };
});

document.getElementById("searchInput").oninput = render;
document.getElementById("sortSelect").onchange = render;

function render(){
  const q = document.getElementById("searchInput").value.toLowerCase();
  const sortMode = document.getElementById("sortSelect").value;

  let list = products.filter(p=>{
    const catOK = activeCategory==="all" || (p.category||"").toLowerCase()===activeCategory.toLowerCase();
    const text = (p.name+" "+p.category+" "+p.description).toLowerCase();
    return catOK && (!q || text.includes(q));
  });

  if(sortMode==="price-asc") list.sort((a,b)=>a.price-b.price);
  if(sortMode==="price-desc") list.sort((a,b)=>b.price-a.price);
  if(sortMode==="newest") list.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));

  const grid = document.getElementById("grid");
  grid.innerHTML="";

  list.forEach(p=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div class="img-wrap"><img src="${p.image}" alt=""></div>
      <div class="name">${escapeHtml(p.name)}</div>
      <div class="cat">${escapeHtml(p.category)}</div>
      <div class="price">‚Çπ ${escapeHtml(p.price)}</div>
      <div class="overlay"><button class="cta">Enquire Now</button></div>
    `;
    card.querySelector(".cta").onclick = ()=>openEnquiry(p);
    grid.appendChild(card);
  });
}

/* ENQUIRY */
let currentProduct=null;
function openEnquiry(p){
  currentProduct=p;
  document.getElementById("enqImg").src=p.image;
  document.getElementById("enqName").textContent=p.name;
  document.getElementById("enqCat").textContent=p.category;
  document.getElementById("enqPrice").textContent="‚Çπ "+p.price;
  document.getElementById("enqMsg").value="";
  document.getElementById("enqPopup").style.display="block";
}
function closeEnq(){
  document.getElementById("enqPopup").style.display="none";
}
function sendEnquiry(){
  const msg=document.getElementById("enqMsg").value;
  const url=`https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(
    `Enquiry for ${currentProduct.name} (${currentProduct.category})\nPrice: ‚Çπ${currentProduct.price}\n\n${msg}`
  )}`;
  window.open(url,"_blank");
  closeEnq();
}
</script>

</body>
</html>
