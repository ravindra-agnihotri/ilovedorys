<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dory's Bakehouse ‚Äì Products</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Great+Vibes&display=swap" rel="stylesheet">

<style>
/* ========== THEME ========== */
:root{
    --bg: rgba(255,243,207,0.45);
    --accent:#563e30;
    --text:#563e30;
    --muted:#6e5a52;
    --card:rgba(253,239,193,0.45);
}

body{
    margin:0;
    font-family:Poppins, system-ui;
    background:var(--bg);
    overflow-x:hidden;
}

/* ========== HEADER ========== */
header{
    width:100%;
    background:#fff;
    padding:14px 20px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
    position:sticky;
    top:0;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    z-index:1000;
}

header .logo{
    height:64px;
}

.home-btn{
    position:absolute;
    left:20px;
    background:var(--accent);
    color:#fff;
    padding:8px 14px;
    border-radius:8px;
    text-decoration:none;
    font-size:14px;
}

.contact-btn{
    position:absolute;
    right:20px;
    background:var(--accent);
    color:#fff;
    padding:8px 14px;
    border-radius:8px;
    text-decoration:none;
    font-size:14px;
}

/* ========== TITLE ========== */
h2{
    text-align:center;
    font-family:'Great Vibes', cursive;
    color:var(--text);
    font-size:42px;
    margin:20px 0 10px;
}

/* ========== FILTER BAR ========== */
.filter-bar{
    display:flex;
    justify-content:center;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:10px;
}

.filter-btn{
    background:var(--accent);
    color:#fff;
    border:0;
    padding:8px 14px;
    border-radius:8px;
    font-size:14px;
    cursor:pointer;
}

.filter-btn.active{
    background:#ff7f7f;
}

/* ========== SEARCH BAR ========== */
.search-wrapper{
    max-width:900px;
    margin:0 auto;
    padding:0 16px 10px;
}

.search-input{
    width:100%;
    padding:12px 16px;
    font-size:15px;
    border-radius:10px;
    border:1px solid #b9a89d;
    background:#fff;
    box-shadow:0 3px 12px rgba(0,0,0,0.08);
    outline:none;
}

/* ========== PRODUCT GRID ========== */
.grid{
    max-width:1300px;
    margin:0 auto 50px;
    padding:0 16px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
    gap:18px;
}

.card{
    background:var(--card);
    padding:10px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
    position:relative;
    transition:0.25s;
}

.card img{
    width:100%;
    height:180px;
    object-fit:cover;
    border-radius:10px;
}

/* Hover Enquire Overlay */
.hover-overlay{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,0.45);
    display:flex;
    justify-content:center;
    align-items:center;
    opacity:0;
    transition:0.25s;
    border-radius:12px;
}

.card:hover .hover-overlay{
    opacity:1;
}

.enquire-btn{
    background:#ff7f7f;
    color:#fff;
    border:0;
    padding:10px 16px;
    border-radius:8px;
    cursor:pointer;
    font-size:14px;
}

/* Text */
.card-title{
    font-size:16px;
    font-weight:600;
    margin-top:8px;
    color:var(--text);
}

.card-cat{
    font-size:13px;
    color:var(--muted);
}

.card-price{
    font-size:15px;
    font-weight:600;
    color:#333;
    margin-top:4px;
}

/* ========== ENQUIRY POPUP ========== */
.enquiry-popup{
    position:fixed;
    z-index:3000;
    background:#fff;
    padding:20px;
    border-radius:14px;
    width:90%;
    max-width:360px;
    box-shadow:0 10px 28px rgba(0,0,0,0.25);
    display:none;
}

.enquiry-popup img{
    width:100px;
    height:100px;
    border-radius:10px;
    object-fit:cover;
}

.popup-row{
    display:flex;
    gap:14px;
}

.close-mini{
    position:absolute;
    right:12px;
    top:10px;
    font-size:22px;
    cursor:pointer;
}

textarea{
    width:100%;
    height:70px;
    border-radius:10px;
    padding:10px;
    margin-top:10px;
}

.send-btn{
    width:100%;
    background:#25D366;
    color:#fff;
    border:0;
    padding:10px;
    margin-top:10px;
    border-radius:10px;
    font-size:15px;
    cursor:pointer;
}

/* ========== FLOATING BUTTONS ========== */
.floating-buttons{
    position:fixed;
    right:25px;
    bottom:25px;
    display:flex;
    flex-direction:column;
    gap:12px;
    z-index:2000;
}

.whatsapp-btn,.chat-btn{
    width:55px;
    height:55px;
    border-radius:50%;
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,0.25);
}

.whatsapp-btn{background:#25D366;}
.chat-btn{background:#ff7f7f;}

.floating-buttons img{
    width:28px;
    height:28px;
}

/* ========== MANAGE PRODUCTS (admin only) ========== */
#manageFloating{
    position:fixed;
    left:20px;
    bottom:30px;
    background:var(--accent);
    color:#fff;
    padding:10px 18px;
    border-radius:10px;
    text-decoration:none;
    font-size:14px;
    display:none; /* only admin sees it */
    z-index:2000;
}

/* ========== CONTACT POPUP ========== */
.popup-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.45);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:5000;
}
.popup-box{
    background:#faebe3;
    padding:22px;
    border-radius:14px;
    text-align:center;
    width:90%;
    max-width:320px;
}
.close-btn{
    margin-top:14px;
    background:var(--accent);
    color:#fff;
    padding:10px;
    border-radius:8px;
    cursor:pointer;
}
</style>
</head>
<body>

<!-- HEADER -->
<header>
    <a class="home-btn" href="/index.html">Home</a>
    <img class="logo" src="/logo/dorys.PNG">
    <a class="contact-btn" onclick="openContact()">Contact</a>
</header>

<h2>Our Products</h2>

<!-- FILTERS -->
<div class="filter-bar">
    <button class="filter-btn active" data-cat="all">All</button>
    <button class="filter-btn" data-cat="Cakes">Cakes</button>
    <button class="filter-btn" data-cat="Cupcakes">Cupcakes</button>
    <button class="filter-btn" data-cat="Pastries">Pastries</button>
</div>

<!-- SEARCH BAR -->
<div class="search-wrapper">
    <input type="text" class="search-input" id="searchBox" placeholder="Search products‚Ä¶">
</div>

<!-- PRODUCT GRID -->
<div class="grid" id="grid"></div>

<!-- FLOATING BUTTONS -->
<div class="floating-buttons">
    <div class="chat-btn" onclick="openContact()">
        <img src="https://cdn-icons-png.flaticon.com/512/134/134914.png">
    </div>
    <a class="whatsapp-btn" href="https://wa.me/9168445014" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg">
    </a>
</div>

<!-- ADMIN MANAGE FLOATING BUTTON -->
<a id="manageFloating" href="/admin-products.html">Manage Products</a>

<!-- ENQUIRY POPUP -->
<div class="enquiry-popup" id="enqBox">
    <span class="close-mini" onclick="closeEnq()">√ó</span>
    <div class="popup-row">
        <img id="enqImg">
        <div>
            <h3 id="enqName"></h3>
            <p id="enqCat"></p>
            <p id="enqPrice"></p>
        </div>
    </div>
    <textarea id="enqMsg" placeholder="Your message..."></textarea>
    <button class="send-btn" onclick="sendEnq()">Send on WhatsApp</button>
</div>

<!-- CONTACT POPUP -->
<div class="popup-overlay" id="contactPopup">
    <div class="popup-box">
        <h3>Contact Us</h3>
        <p>üìû <a href="tel:+917972032790" style="color:var(--text);font-weight:700;text-decoration:none;">+91 7972032790</a></p>
        <p>üìç Dory's Bakehouse, Pune</p>
        <div class="close-btn" onclick="closeContact()">Close</div>
    </div>
</div>

<script>
/* =============================
   LOAD PRODUCTS
============================= */
async function loadProducts(){
    const res = await fetch('/products/list',{cache:'no-cache'});
    const list = await res.json();
    window.fullProducts = list;
    renderProducts(list);
}

/* =============================
   RENDER PRODUCTS
============================= */
function renderProducts(arr){
    const grid = document.getElementById('grid');
    grid.innerHTML = "";

    arr.forEach(p=>{
        const div = document.createElement('div');
        div.className = "card";

        div.innerHTML = `
            <img src="${p.image}">
            <div class="hover-overlay">
                <button class="enquire-btn" onclick="openEnq('${p.id}')">Enquire Now</button>
            </div>
            <div class="card-title">${p.name}</div>
            <div class="card-cat">${p.category}</div>
            <div class="card-price">‚Çπ ${p.price}</div>
        `;
        grid.appendChild(div);
    });
}

/* =============================
   FILTERS
============================= */
document.querySelectorAll(".filter-btn").forEach(btn=>{
    btn.onclick = ()=>{
        document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        applyFilters();
    };
});

/* =============================
   SEARCH FUNCTION
============================= */
document.getElementById('searchBox').addEventListener('input', applyFilters);

function applyFilters(){
    const cat = document.querySelector(".filter-btn.active").dataset.cat;
    const search = document.getElementById('searchBox').value.toLowerCase();

    let arr = window.fullProducts;

    if(cat !== "all"){
        arr = arr.filter(p => p.category === cat);
    }

    if(search.trim() !== ""){
        arr = arr.filter(p =>
            p.name.toLowerCase().includes(search) ||
            p.category.toLowerCase().includes(search) ||
            p.description?.toLowerCase().includes(search)
        );
    }

    renderProducts(arr);
}

/* =============================
   ENQUIRY POPUP
============================= */
function openEnq(id){
    const p = window.fullProducts.find(x=>x.id===id);

    document.getElementById("enqImg").src = p.image;
    document.getElementById("enqName").textContent = p.name;
    document.getElementById("enqCat").textContent = "Category: "+p.category;
    document.getElementById("enqPrice").textContent = "‚Çπ "+p.price;

    document.getElementById("enqBox").style.display = "block";
    window.currentProduct = p;
}

function closeEnq(){
    document.getElementById("enqBox").style.display = "none";
}

function sendEnq(){
    const p = window.currentProduct;
    const msg = document.getElementById("enqMsg").value;

    const text = `
Product Enquiry:
Name: ${p.name}
Category: ${p.category}
Price: ‚Çπ ${p.price}

User Message:
${msg}
`;

    window.open("https://wa.me/9168445014?text="+encodeURIComponent(text), "_blank");
}

/* =============================
   CONTACT POPUP
============================= */
function openContact(){
    document.getElementById("contactPopup").style.display="flex";
}
function closeContact(){
    document.getElementById("contactPopup").style.display="none";
}

/* =============================
   ADMIN BUTTON
============================= */
function readCookie(name){
    const c = document.cookie.split("; ").find(x=>x.startsWith(name+"="));
    return c ? c.split("=")[1] : null;
}

window.addEventListener('DOMContentLoaded', ()=>{
    if(readCookie("admin")==="4321"){
        document.getElementById("manageFloating").style.display="block";
    }
});

loadProducts();
</script>
</body>
</html>
