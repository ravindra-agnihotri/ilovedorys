<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin ‚Äì Manage Products | Dory's Bakehouse</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Great+Vibes&display=swap" rel="stylesheet">

<style>
:root {
    --bg: rgba(255, 243, 207, 0.45);
    --accent: #563e30;
    --text: #563e30;
    --muted: #6e5a52;
    --card: rgba(253,239,193,0.45);
}

body {
    margin:0;
    font-family:Poppins, system-ui;
    background:var(--bg);
    overflow-x:hidden;
}

/* HEADER */
header {
    background:#fff;
    padding:14px 20px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
    display:flex;
    justify-content:center;
    align-items:center;
    position:sticky;
    top:0;
    z-index:1000;
    position:relative;
}

.logo {
    height:64px;
}

.home-btn {
    position:absolute;
    left:20px;
    background:var(--accent);
    color:#fff;
    padding:8px 14px;
    border-radius:8px;
    text-decoration:none;
    font-size:14px;
}
.logout-btn {
    position:absolute;
    right:20px;
    background:#ff7f7f;
    color:#fff;
    padding:8px 14px;
    border-radius:8px;
    font-size:14px;
    cursor:pointer;
}

/* LOGIN BOX */
#loginBox {
    max-width:360px;
    background:#fff;
    padding:22px;
    margin:40px auto;
    border-radius:12px;
    box-shadow:0 6px 18px rgba(0,0,0,0.12);
}
#loginBox h3 {
    margin:0 0 12px;
    color:var(--text);
}
input[type=password] {
    width:100%;
    padding:10px;
    margin:10px 0;
    border-radius:8px;
    border:1px solid #aaa;
}

/* ADMIN AREA */
#adminArea {
    display:none;
    max-width:950px;
    margin:20px auto;
    padding:10px;
}

.section {
    background:#fff;
    padding:18px;
    border-radius:12px;
    box-shadow:0 6px 18px rgba(0,0,0,0.12);
    margin-bottom:20px;
}

.section h3 {
    margin:0 0 12px;
    color:var(--text);
}

/* FORM */
label {
    font-weight:500;
}
input[type=text], input[type=number], textarea, select {
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #aaa;
    margin:8px 0 14px;
}
textarea { height:80px; }

/* PRODUCT LIST */
.card {
    background:var(--card);
    padding:12px;
    border-radius:12px;
    display:flex;
    gap:14px;
    align-items:center;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
    margin-bottom:14px;
}

.card img {
    width:80px;
    height:80px;
    object-fit:cover;
    border-radius:10px;
}
.delete-btn {
    background:#ff7f7f;
    color:#fff;
    padding:8px 12px;
    border-radius:8px;
    border:0;
    cursor:pointer;
}

/* FLOATING BUTTONS */
.floating-buttons{
    position:fixed;
    right:25px;
    bottom:25px;
    display:flex;
    flex-direction:column;
    gap:12px;
    z-index:2000;
}
.whatsapp-btn,.chat-btn{
    width:55px;
    height:55px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,0.25);
}
.whatsapp-btn{background:#25D366;}
.chat-btn{background:#ff7f7f;}
.floating-buttons img{width:28px;height:28px;}

/* CONTACT POPUP */
.popup-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.45);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:5000;
}
.popup-box{
    background:#faebe3;
    padding:22px;
    border-radius:14px;
    text-align:center;
    width:90%;
    max-width:320px;
}
.close-btn{
    margin-top:14px;
    background:var(--accent);
    color:#fff;
    padding:10px;
    border-radius:8px;
}

</style>
</head>
<body>

<header>
    <a class="home-btn" href="/index.html">Home</a>
    <img class="logo" src="/logo/dorys.PNG">
    <div class="logout-btn" onclick="logout()">Logout</div>
</header>

<!-- LOGIN BOX -->
<div id="loginBox">
    <h3>Admin Login</h3>
    <input type="password" id="pin" placeholder="Enter PIN (4321)">
    <button onclick="login()">Login</button>
</div>

<!-- ADMIN AREA -->
<div id="adminArea">

    <!-- ADD PRODUCT -->
    <div class="section">
        <h3>Add Product</h3>

        <label>Name</label>
        <input type="text" id="pname">

        <label>Description</label>
        <textarea id="pdesc"></textarea>

        <label>Price (‚Çπ)</label>
        <input type="number" id="pprice" min="0">

        <label>Category</label>
        <select id="pcategory">
            <option value="">Select Category</option>
            <option value="Cakes">Cakes</option>
            <option value="Cupcakes">Cupcakes</option>
            <option value="Pastries">Pastries</option>
        </select>

        <label>Product Image</label>
        <input type="file" id="pimage" accept="image/*,.heic,.HEIC"/>

        <button onclick="addProduct()">Add Product</button>
        <div id="addStatus" style="margin-top:10px;color:green;font-weight:600;"></div>
    </div>

    <!-- PRODUCT LIST -->
    <div class="section">
        <h3>Existing Products</h3>
        <div id="productList"></div>
    </div>

</div>

<!-- FLOATING BUTTONS -->
<div class="floating-buttons">
    <div class="chat-btn" onclick="openContact()">
        <img src="https://cdn-icons-png.flaticon.com/512/134/134914.png">
    </div>
    <a class="whatsapp-btn" href="https://wa.me/9168445014" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg">
    </a>
</div>

<!-- CONTACT POPUP -->
<div class="popup-overlay" id="contactPopup">
    <div class="popup-box">
        <h3>Contact Us</h3>
        <p>üìû <a href="tel:+917972032790" style="color:var(--text);text-decoration:none;font-weight:700">+91 7972032790</a></p>
        <p>üìç Dory's Bakehouse, Pune</p>
        <div class="close-btn" onclick="closeContact()">Close</div>
    </div>
</div>

<script>
/* ==========================
   ADMIN LOGIN
========================== */
function login(){
    const pin = document.getElementById('pin').value;
    if(pin === "4321"){
        document.cookie = "admin=4321; path=/; max-age=86400;";
        document.getElementById('loginBox').style.display='none';
        document.getElementById('adminArea').style.display='block';
        loadProducts();
    } else {
        alert("Incorrect PIN");
    }
}

function logout(){
    document.cookie = "admin=; path=/; max-age=0;";
    location.reload();
}

function readCookie(name){
    const c = document.cookie.split('; ').find(r => r.startsWith(name+'='));
    return c ? c.split('=')[1] : null;
}

window.addEventListener('DOMContentLoaded',()=>{
    if(readCookie('admin')==='4321'){
        document.getElementById('loginBox').style.display='none';
        document.getElementById('adminArea').style.display='block';
        loadProducts();
    }
});

/* ==========================
   LOAD PRODUCTS
========================== */
async function loadProducts(){
    const res = await fetch('/products/list', {cache:'no-cache'});
    const list = await res.json();

    const box = document.getElementById('productList');
    box.innerHTML = "";

    list.forEach(p=>{
        const div = document.createElement('div');
        div.className='card';

        div.innerHTML = `
            <img src="${p.image}">
            <div style="flex:1">
                <div><b>${p.name}</b></div>
                <div>${p.category}</div>
                <div>‚Çπ ${p.price}</div>
            </div>
            <button class="delete-btn" onclick="deleteProduct('${p.id}')">Delete</button>
        `;

        box.appendChild(div);
    });
}

/* ==========================
   ADD PRODUCT
========================== */
async function addProduct(){
    const name = document.getElementById('pname').value.trim();
    const desc = document.getElementById('pdesc').value.trim();
    const price = document.getElementById('pprice').value.trim();
    const category = document.getElementById('pcategory').value;
    const file = document.getElementById('pimage').files[0];

    if(!name || !price || !category){
        alert("Name, Price, Category are required");
        return;
    }

    const fd = new FormData();
    fd.append('name', name);
    fd.append('description', desc);
    fd.append('price', price);
    fd.append('category', category);
    if(file) fd.append('image', file);

    const res = await fetch('/products/add', {
        method:'POST',
        body:fd
    });

    const data = await res.json();
    document.getElementById('addStatus').textContent = "Product Added!";
    loadProducts();
}

/* ==========================
   DELETE PRODUCT
========================== */
async function deleteProduct(id){
    if(!confirm("Delete this product?")) return;

    await fetch('/products/delete', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({id})
    });

    loadProducts();
}

/* ==========================
   CONTACT POPUP
========================== */
function openContact(){
    document.getElementById('contactPopup').style.display='flex';
}
function closeContact(){
    document.getElementById('contactPopup').style.display='none';
}

</script>
</body>
</html>
